resources:
  repositories:
  - repository: templates
    type: github
    name: tomtompilot/nk2ui-pipeline-templates
    ref: 'refs/heads/master'
    endpoint: tomtompilot

variables:
  - template: global/vars.yml@templates
  - group: credentials

trigger:
  batch: true
  branches:
    include:
      - master
      - pull/**
      - build/**

stages:
- stage:
  displayName: Build & Test
  jobs:
  - template: quality/copyright_check.yml@templates
  - job:
    displayName: Running build and unit tests
    pool:
      vmImage: macOS-10.14
    steps:
    - script: sleep 180
    - task: Gradle@2
      inputs:
        workingDirectory: ''
        gradleWrapperFile: 'gradlew'
        gradleOptions: '-Xmx3072m'
        javaHomeOption: 'JDKVersion'
        jdkVersionOption: '1.8'
        jdkArchitectureOption: 'x64'
        publishJUnitResults: true
        testResultsFiles: '**/TEST-*.xml'
        tasks: 'assembleDebug test'
      displayName: gradlew assembleDebug test
